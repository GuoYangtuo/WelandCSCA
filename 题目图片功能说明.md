# 题目图片附带功能说明

## 功能概述

现在题目支持附带图片功能，可以为题目上传配图，便于展示图表、示意图等视觉内容。

## 实现的功能

### 1. 数据库层面
- ✅ 在 `questions` 表中添加 `image_url` 字段（VARCHAR 500）
- ✅ 自动迁移脚本，兼容已有数据

### 2. 后端API
- ✅ 新增图片上传接口：`POST /api/admin/questions/upload-image`
- ✅ 新增图片删除接口：`DELETE /api/admin/questions/image/:filename`
- ✅ 更新题目添加/更新/批量添加接口，支持 `image_url` 字段
- ✅ 图片文件保存在 `server/uploads/question-images/` 目录
- ✅ 服务器重启时自动保留该目录（不会被清空）

### 3. 前端功能

#### 题目上传页面
- ✅ 在题目表单中添加图片上传区域
- ✅ 支持点击上传图片（JPG、PNG、GIF、WebP 格式）
- ✅ 图片大小限制：10MB
- ✅ 图片预览功能
- ✅ 删除图片功能
- ✅ 上传进度提示

#### 题目管理页面
- ✅ 编辑题目弹窗中支持图片上传和管理
- ✅ 显示已上传的题目配图
- ✅ 可以更换或删除图片

### 4. 类型定义
- ✅ `QuestionForm` 接口添加 `image_url` 和 `image_file` 字段
- ✅ `ExistingQuestion` 接口添加 `image_url` 字段

## 使用方法

### 上传题目时添加图片

1. 在"题目管理"页面，选择"图片解析"或"手动输入"模式
2. 在题目编辑卡片中找到"题目配图"区域
3. 点击"点击上传图片"按钮
4. 选择图片文件（支持 JPG、PNG、GIF、WebP，最大 10MB）
5. 等待上传完成，图片会显示预览
6. 如需删除图片，点击"删除图片"按钮
7. 提交题目入库

### 编辑现有题目的图片

1. 在"题库管理"页面，找到要编辑的题目
2. 点击"编辑"按钮
3. 在编辑弹窗中找到"题目配图"区域
4. 上传新图片或删除现有图片
5. 点击"保存修改"

## 技术细节

### 上传流程

```
前端选择图片 → 
  调用 uploadQuestionImage API → 
    后端接收并保存到 uploads/question-images/ → 
      返回图片URL → 
        前端更新题目 image_url 字段 → 
          提交题目时包含 image_url
```

### 文件存储

- **存储位置**：`server/uploads/question-images/`
- **文件命名**：`question-{timestamp}-{random}.{ext}`
- **URL 格式**：`/uploads/question-images/{filename}`
- **持久化**：服务器重启不会删除

### 安全性

- ✅ 文件类型验证（仅允许图片格式）
- ✅ 文件大小限制（10MB）
- ✅ 需要管理员权限才能上传
- ✅ 文件名随机化，防止冲突

## 注意事项

1. **图片大小**：建议上传的图片宽度不超过 1200px，以获得最佳显示效果
2. **图片格式**：推荐使用 JPG 或 PNG 格式
3. **存储空间**：请定期检查服务器存储空间，必要时清理不再使用的图片
4. **删除题目**：删除题目时，图片文件不会自动删除（需要手动管理）

## 后续优化建议

1. 添加图片压缩功能，自动优化上传的图片
2. 删除题目时自动删除关联的图片文件
3. 添加图片管理页面，批量管理未使用的图片
4. 支持图片裁剪和旋转功能
5. 添加图片 CDN 加速支持

## 更新日志

- **2024-12-22**：初始版本，完成基础图片上传功能

